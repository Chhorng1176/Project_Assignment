{% extends "layouts/base.html" %}
{% block title %}Expert Statistics{% endblock %}

{% block content %}
<div class="container-fluid">

    <!-- ===============================
         PAGE TITLE
    =============================== -->
    <div class="d-flex align-items-center mb-4">
        <img src="{{ url_for('static', filename='img/logo/Expert Statistics.png') }}"
             style="width:28px;height:28px;margin-right:10px;">
        <h1 class="h4 mb-0 font-weight-bold text-success">
            Expert Statistics Dashboard
        </h1>
    </div>

    <!-- ===============================
         SUMMARY CARDS
    =============================== -->
    <div class="row mb-4">

        <!-- TOTAL DIAGNOSES -->
        <div class="col-md-4 mb-3">
            <div class="card h-100 p-3">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <div class="text-muted text-uppercase small mb-1">
                            Total Diagnoses
                        </div>
                        <div class="dashboard-number">
                            {{ total_diagnoses or 0 }}
                        </div>
                    </div>
                    <img src="{{ url_for('static', filename='img/logo/total-diagnoses.png') }}"
                         class="stat-icon-img"
                         alt="Total Diagnoses">
                </div>
            </div>
        </div>

        <!-- APPROVED -->
        <div class="col-md-4 mb-3">
            <div class="card h-100 p-3">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <div class="text-muted text-uppercase small mb-1">
                            Approved
                        </div>
                        <div class="dashboard-number">
                            {{ approved_count or 0 }}
                        </div>
                    </div>
                    <img src="{{ url_for('static', filename='img/logo/total-diagnoses.png') }}"
                         class="stat-icon-img"
                         alt="Approved">
                </div>
            </div>
        </div>

        <!-- PENDING -->
        <div class="col-md-4 mb-3">
            <div class="card h-100 p-3">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <div class="text-muted text-uppercase small mb-1">
                            Pending
                        </div>
                        <div class="dashboard-number">
                            {{ pending_count or 0 }}
                        </div>
                    </div>
                    <img src="{{ url_for('static', filename='img/logo/pending-diagnoses.png') }}"
                         class="stat-icon-img"
                         alt="Pending Diagnoses">
                </div>
            </div>
        </div>

    </div>

    <!-- ===============================
         CHARTS
    =============================== -->
    <div class="row">

        <!-- MONTHLY LINE CHART -->
        <div class="col-lg-8 mb-4">
            <div class="card shadow-sm">
                <div class="card-header d-flex align-items-center">
                    <img src="{{ url_for('static', filename='img/logo/Expert Statistics.png') }}"
                         style="width:18px;height:18px;margin-right:8px;">
                    <span class="font-weight-bold">Monthly Diagnoses</span>
                </div>
                <div class="card-body">
                    <canvas id="monthlyChart" height="120"></canvas>
                </div>
            </div>
        </div>

        <!-- TOP DISEASES -->
        <div class="col-lg-4 mb-4">
            <div class="card shadow-sm">
                <div class="card-header d-flex align-items-center">
                    <img src="{{ url_for('static', filename='img/logo/Expert Statistics.png') }}"
                         style="width:18px;height:18px;margin-right:8px;">
                    <span class="font-weight-bold">Top Diseases</span>
                </div>
                <div class="card-body">
                    <canvas id="diseaseChart"></canvas>
                </div>
            </div>
        </div>

    </div>

</div>

<!-- ===============================
     CHART.JS
=============================== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* ===============================
   MONTHLY LINE CHART
=============================== */
const monthlyCtx = document.getElementById("monthlyChart");

if (monthlyCtx) {
    new Chart(monthlyCtx, {
        type: "line",
        data: {
            labels: {{ months|default([])|tojson }},
            datasets: [{
                label: "Diagnoses",
                data: {{ month_values|default([])|tojson }},
                borderColor: "#1f7a6e",
                backgroundColor: "rgba(31,122,110,0.1)",
                borderWidth: 2,
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: true }
            }
        }
    });
}

/* ===============================
   DISEASE PIE CHART
=============================== */
const diseaseCtx = document.getElementById("diseaseChart");

if (diseaseCtx) {
    new Chart(diseaseCtx, {
        type: "pie",
        data: {
            labels: {{ disease_labels|default([])|tojson }},
            datasets: [{
                data: {{ disease_values|default([])|tojson }}
            }]
        },
        options: {
            responsive: true
        }
    });
}
</script>
{% endblock %}
